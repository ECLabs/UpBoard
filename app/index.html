<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>small_byte</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
		<script src="scripts/modernizr.custom.js"></script>
        <!-- Font -->
        <link href='http://fonts.googleapis.com/css?family=Slabo+27px' rel='stylesheet' type='text/css'>

        <link rel="stylesheet" href="styles/main.css">
        <link rel="icon" type="image/ico" href="../images/icon.png">

    </head>
    <body>
        <div class="container">
            <!--logo -->
            <img class="movingBackground"></img>
            <img class="logo"></img>

            <!--liveVideoOverlay -->
            <video  autoplay="true" class="hidden" id="videoElement"></video>
            <div class="hidden box">
                <p>
                    <!--liveVideoOverlayContent Injected Here -->
                </p>
                <div class="boxBottomLeft"></div>
                <img id="star"></img>
                <div class="boxBottomRight"></div>
            </div>

            <!--fourPanel -->
            <div id="bl-main" class="bl-main hidden">

                <section id="section1">
                    <div class="bl-box">
                        <h2 class="bl-icon bl-icon-about"><!--fourPanel top left first name Injected Here --></h2>
                    </div>
                    <div class="bl-content">
                        <h2><!--fourPanel top left name Injected Here --></h2>
                        <p><!--fourPanel top left text Injected Here --></p>
                    </div>
                </section>

                <section id="section2">
                    <div class="bl-box">
                        <h2 class="bl-icon bl-icon-works"><!--fourPanel top right first name Injected Here --></h2>
                    </div>
                    <div class="bl-content">
                        <h2><!--fourPanel top right name Injected Here --></h2>
                        <p><!--fourPanel top right text Injected Here --></p>
                    </div>
                </section>

                <section id="section3">
                    <div class="bl-box">
                        <h2 class="bl-icon bl-icon-blog"><!--fourPanel botto left first name Injected Here --></h2>
                    </div>
                    <div class="bl-content">
                        <h2><!--fourPanel bottom left name Injected Here --></h2>
                        <p><!--fourPanel bottom left text Injected Here --></p>
                    </div>
                </section>

                <section id="section4">
                    <div class="bl-box">
                        <h2 class="bl-icon bl-icon-contact"><!--fourPanel bottom right first name Injected Here --></h2>
                    </div>
                    <div class="bl-content">
                        <h2><!--fourPanel bottom right name Injected Here --></h2>
                        <p><!--fourPanel bottom right text Injected Here --></p>
                    </div>
                </section>

            </div>

        </div>
        <script src="../bower_components/jquery/dist/jquery.js"></script>
        <script src="https://cdn.firebase.com/js/client/2.2.4/firebase.js"></script>
        <script type="text/javascript">
            var firebaseRef = new Firebase("https://boiling-heat-9947.firebaseio.com/");

        </script>
        <script src="scripts/fourPanel.js"></script>
        <script src="scripts/liveVideoOverlay.js"></script>
        <script src="scripts/logo.js"></script>
        <script>
            $(function() {

                //set up webcam feed
                (function() {

                    var video = document.querySelector("#videoElement");

                    navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia || navigator.oGetUserMedia;

                    if (navigator.getUserMedia) {
                        navigator.getUserMedia({video: true, audio: true}, handleVideo, videoError);
                    }

                    function handleVideo(stream) {

                        video.src = window.URL.createObjectURL(stream);
                        video.volume = 0;

                    }

                    function videoError(e) {
                        console.log('error, no webcam support found');
                    }

                })();

                //get firebase info
                firebaseRef.once('value', function(snapshot) {

                    //holder array to specify slide order
                    var slideOrder = [];
                    //fill in order array
                    snapshot.forEach(function(childSnapshot) {
                        var key = childSnapshot.val();
                        slideOrder.push(key.type);
                    });

                    //calculate total slideshow time
                    var totalTime = function() {
                        var time=2000;
                        snapshot.forEach(function(childSnapshot) {

                            var key = childSnapshot.val();

                            if(key.type ==='logo' || key.type==='liveVideoOverlay'){
                              time+= (key.timing.slideTime + key.timing.transitionTime);
                            } else if (key.type==='fourPanel'){
                              time+= (key.timing.openFirstSection + (key.timing.openSection*4) + (key.timing.sectionTime*4) + key.timing.transitionTime);
                            }

                        });
                      return time;
                    };

                    // start interval
                    (function(){
                        setInterval(function(){
                            window[slideOrder[0]](snapshot.val(), slideOrder, 0);
                        }, totalTime());
                    })();

                    window[slideOrder[0]](snapshot.val(), slideOrder, 0); //pass slide1 the firebase data & array
                });

            });
        </script>
</body>
</html>
